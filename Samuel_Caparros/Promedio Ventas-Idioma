import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Cargar y normalizar columnas
df = pd.read_csv('E-commerce Website Logs.csv')
df.columns = [col.strip().lower().replace(' ', '_') for col in df.columns]

# Agrupar por idioma y calcular promedio de ventas
language_grouped = df.groupby('language')['sales'].mean().sort_values(ascending=False)

# Convertir a arrays
language_types = language_grouped.index.to_numpy()
language_sales_avg = language_grouped.values

# Crear color degradado
colors = plt.cm.viridis(np.linspace(0.2, 0.9, len(language_sales_avg)))

# Crear gráfico
plt.figure(figsize=(14,8))
bars = plt.bar(language_types, language_sales_avg, color=colors, edgecolor='black')

# Etiquetas encima de las barras con formato claro
for bar, value in zip(bars, language_sales_avg):
    plt.text(
        bar.get_x() + bar.get_width() / 2,
        bar.get_height() + max(language_sales_avg) * 0.01,
        f'{value:,.0f}',
        ha='center',
        va='bottom',
        fontsize=10,
        fontweight='bold'
    )

# Personalización visual
plt.title('Promedio de Ventas por Idioma', fontsize=18)
plt.xlabel('Idioma', fontsize=14)
plt.ylabel('Promedio de Ventas', fontsize=14)
plt.xticks(rotation=45, ha='right')
plt.grid(axis='y', linestyle='--', alpha=0.6)
plt.tight_layout()

# Guardar como PNG
plt.savefig('promedio_ventas_por_idioma.png')

# Mostrar gráfico
plt.show()
